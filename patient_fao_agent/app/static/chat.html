<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>AI Patient Education & FAQ</title>-->
<!--    <style>-->
<!--        * { margin: 0; padding: 0; box-sizing: border-box; }-->
<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            height: 100vh;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--        }-->
<!--        .container {-->
<!--            width: 90%;-->
<!--            max-width: 800px;-->
<!--            height: 90vh;-->
<!--            background: white;-->
<!--            border-radius: 20px;-->
<!--            box-shadow: 0 20px 60px rgba(0,0,0,0.3);-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        .header {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .header h1 { font-size: 24px; margin-bottom: 5px; }-->
<!--        .header p { font-size: 14px; opacity: 0.9; }-->
<!--        .verify-section, .chat-section { padding: 20px; }-->
<!--        .verify-section {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            flex: 1;-->
<!--        }-->
<!--        .input-group {-->
<!--            width: 100%;-->
<!--            max-width: 400px;-->
<!--        }-->
<!--        .input-group label {-->
<!--            display: block;-->
<!--            margin-bottom: 8px;-->
<!--            color: #333;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .input-group input {-->
<!--            width: 100%;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        .btn {-->
<!--            padding: 12px 30px;-->
<!--            border: none;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s;-->
<!--        }-->
<!--        .btn-primary {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }-->
<!--        .btn-primary:disabled {-->
<!--            opacity: 0.6;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->
<!--        .chat-section {-->
<!--            display: none;-->
<!--            flex-direction: column;-->
<!--            flex: 1;-->
<!--            min-height: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        .chat-info {-->
<!--            background: #f8f9fa;-->
<!--            padding: 10px 15px;-->
<!--            border-radius: 0;-->
<!--            font-size: 14px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .messages {-->
<!--            flex: 1;-->
<!--            overflow-y: auto;-->
<!--            padding: 20px;-->
<!--            background: #f8f9fa;-->
<!--            min-height: 0;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar {-->
<!--            width: 8px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-track {-->
<!--            background: #f1f1f1;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb {-->
<!--            background: #888;-->
<!--            border-radius: 4px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb:hover {-->
<!--            background: #555;-->
<!--        }-->
<!--        .message {-->
<!--            margin-bottom: 15px;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            animation: slideIn 0.3s ease;-->
<!--        }-->
<!--        @keyframes slideIn {-->
<!--            from { opacity: 0; transform: translateY(10px); }-->
<!--            to { opacity: 1; transform: translateY(0); }-->
<!--        }-->
<!--        .message.user { justify-content: flex-end; }-->
<!--        .message-content {-->
<!--            max-width: 70%;-->
<!--            padding: 12px 16px;-->
<!--            border-radius: 12px;-->
<!--            line-height: 1.5;-->
<!--            white-space: pre-wrap;-->
<!--            word-wrap: break-word;-->
<!--        }-->
<!--        .message.bot .message-content {-->
<!--            background: white;-->
<!--            color: #333;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .message.user .message-content {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .input-area {-->
<!--            padding: 15px;-->
<!--            background: white;-->
<!--            border-top: 1px solid #ddd;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .input-area input {-->
<!--            flex: 1;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 25px;-->
<!--            font-size: 14px;-->
<!--        }-->
<!--        .upload-area {-->
<!--            padding: 15px;-->
<!--            background: #f8f9fa;-->
<!--            border-top: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .file-input-wrapper {-->
<!--            position: relative;-->
<!--            display: inline-block;-->
<!--        }-->
<!--        .file-input-wrapper input[type=file] {-->
<!--            position: absolute;-->
<!--            opacity: 0;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            cursor: pointer;-->
<!--            left: 0;-->
<!--            top: 0;-->
<!--        }-->
<!--        .loading {-->
<!--            text-align: center;-->
<!--            color: #666;-->
<!--            padding: 10px;-->
<!--            font-style: italic;-->
<!--        }-->
<!--        .error {-->
<!--            color: #dc3545;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #ffebee;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .success {-->
<!--            color: #28a745;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #e8f5e9;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .typing-indicator {-->
<!--            display: inline-block;-->
<!--            padding: 12px 16px;-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .typing-indicator span {-->
<!--            height: 8px;-->
<!--            width: 8px;-->
<!--            background: #667eea;-->
<!--            border-radius: 50%;-->
<!--            display: inline-block;-->
<!--            margin-right: 5px;-->
<!--            animation: bounce 1.4s infinite ease-in-out;-->
<!--        }-->
<!--        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }-->
<!--        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }-->
<!--        @keyframes bounce {-->
<!--            0%, 80%, 100% { transform: scale(0); }-->
<!--            40% { transform: scale(1); }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container">-->
<!--        <div class="header">-->
<!--            <h1>üè• AI Patient Education</h1>-->
<!--            <p>Get clear explanations for your medical documents and health questions</p>-->
<!--        </div>-->

<!--        &lt;!&ndash; Verification Section &ndash;&gt;-->
<!--        <div class="verify-section" id="verifySection">-->
<!--            <div class="input-group">-->
<!--                <label for="mobileNumber">Enter your mobile number</label>-->
<!--                <input type="tel" id="mobileNumber" placeholder="+91 1234567890" />-->
<!--            </div>-->
<!--            <button class="btn btn-primary" onclick="verifyPatient()">Verify & Continue</button>-->
<!--            <div id="verifyMessage"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Chat Section &ndash;&gt;-->
<!--        <div class="chat-section" id="chatSection">-->
<!--            <div class="chat-info" id="patientInfo"></div>-->
<!--            <div class="messages" id="messages"></div>-->
<!--            <div class="upload-area">-->
<!--                <div class="file-input-wrapper">-->
<!--                    <button class="btn btn-primary" id="uploadBtn">üìÑ Upload Medical Document (PDF)</button>-->
<!--                    <input type="file" id="fileInput" accept=".pdf" />-->
<!--                </div>-->
<!--                <div id="uploadStatus"></div>-->
<!--            </div>-->
<!--            <div class="input-area">-->
<!--                <input type="text" id="queryInput" placeholder="Ask a health question..."-->
<!--                       onkeypress="if(event.key==='Enter') sendQuery()" />-->
<!--                <button class="btn btn-primary" onclick="sendQuery()">Send</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script>-->
<!--        let patientId = null;-->
<!--        let patientName = null;-->
<!--        let sessionId = null;-->

<!--        // Setup file input listener after DOM loads-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            const fileInput = document.getElementById('fileInput');-->
<!--            if (fileInput) {-->
<!--                fileInput.addEventListener('change', uploadDocument);-->
<!--            }-->
<!--        });-->

<!--        async function verifyPatient() {-->
<!--            const mobile = document.getElementById('mobileNumber').value;-->
<!--            const msgDiv = document.getElementById('verifyMessage');-->

<!--            if (!mobile) {-->
<!--                msgDiv.innerHTML = '<p class="error">Please enter mobile number</p>';-->
<!--                return;-->
<!--            }-->

<!--            msgDiv.innerHTML = '<p class="loading">Verifying...</p>';-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/verify-patient', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({ mobile_number: mobile })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (data.verified) {-->
<!--                    patientId = data.patient_id;-->
<!--                    patientName = data.patient_name;-->
<!--                    document.getElementById('verifySection').style.display = 'none';-->
<!--                    document.getElementById('chatSection').style.display = 'flex';-->
<!--                    document.getElementById('patientInfo').innerHTML =-->
<!--                        `<strong>Welcome, ${patientName}!</strong> Ask questions or upload your medical documents.`;-->
<!--                    addMessage('bot', 'Hello! I can help explain your medical documents and answer health questions. How can I assist you today?');-->
<!--                } else {-->
<!--                    msgDiv.innerHTML = `<p class="error">${data.message}</p>`;-->
<!--                }-->
<!--            } catch (error) {-->
<!--                msgDiv.innerHTML = '<p class="error">Error verifying patient. Please try again.</p>';-->
<!--                console.error('Verification error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function sendQuery() {-->
<!--            const input = document.getElementById('queryInput');-->
<!--            const query = input.value.trim();-->

<!--            if (!query) return;-->

<!--            addMessage('user', query);-->
<!--            input.value = '';-->

<!--            // Show typing indicator-->
<!--            const typingId = addTypingIndicator();-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/chat/query', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({-->
<!--                        patient_id: patientId,-->
<!--                        query: query,-->
<!--                        session_id: sessionId-->
<!--                    })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                // Remove typing indicator-->
<!--                removeTypingIndicator(typingId);-->

<!--                sessionId = data.session_id;-->
<!--                addMessage('bot', data.response);-->
<!--            } catch (error) {-->
<!--                removeTypingIndicator(typingId);-->
<!--                addMessage('bot', 'Sorry, I encountered an error. Please try again.');-->
<!--                console.error('Query error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function uploadDocument(event) {-->
<!--            const file = event.target.files[0];-->
<!--            const statusDiv = document.getElementById('uploadStatus');-->
<!--            const uploadBtn = document.getElementById('uploadBtn');-->

<!--            if (!file) return;-->

<!--            // Validate file type-->
<!--            if (file.type !== 'application/pdf') {-->
<!--                statusDiv.innerHTML = '<p class="error">Please upload a PDF file only</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            // Validate file size (10MB)-->
<!--            if (file.size > 10 * 1024 * 1024) {-->
<!--                statusDiv.innerHTML = '<p class="error">File size must be less than 10MB</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            statusDiv.innerHTML = '<p class="loading">Processing document... This may take a moment.</p>';-->
<!--            uploadBtn.disabled = true;-->
<!--            addMessage('user', `üìÑ Uploaded: ${file.name}`);-->

<!--            const formData = new FormData();-->
<!--            formData.append('file', file);-->
<!--            formData.append('patient_id', patientId);-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/chat/upload-document', {-->
<!--                    method: 'POST',-->
<!--                    body: formData-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (data.success) {-->
<!--                    statusDiv.innerHTML = '<p class="success">‚úì Document processed successfully!</p>';-->
<!--                    addMessage('bot', data.explanation);-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                } else {-->
<!--                    statusDiv.innerHTML = `<p class="error">${data.message}</p>`;-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                }-->
<!--            } catch (error) {-->
<!--                statusDiv.innerHTML = '<p class="error">Error uploading document. Please try again.</p>';-->
<!--                console.error('Upload error:', error);-->
<!--                setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--            } finally {-->
<!--                uploadBtn.disabled = false;-->
<!--                event.target.value = '';-->
<!--            }-->
<!--        }-->

<!--        function addMessage(type, text) {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const messageDiv = document.createElement('div');-->
<!--            messageDiv.className = `message ${type}`;-->
<!--            messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;-->
<!--            messagesDiv.appendChild(messageDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--        }-->

<!--        function addTypingIndicator() {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const typingDiv = document.createElement('div');-->
<!--            const typingId = 'typing-' + Date.now();-->
<!--            typingDiv.id = typingId;-->
<!--            typingDiv.className = 'message bot';-->
<!--            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';-->
<!--            messagesDiv.appendChild(typingDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--            return typingId;-->
<!--        }-->

<!--        function removeTypingIndicator(typingId) {-->
<!--            const typingDiv = document.getElementById(typingId);-->
<!--            if (typingDiv) {-->
<!--                typingDiv.remove();-->
<!--            }-->
<!--        }-->

<!--        function escapeHtml(text) {-->
<!--            const div = document.createElement('div');-->
<!--            div.textContent = text;-->
<!--            return div.innerHTML;-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->



<!--##version second-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>AI Patient Education & FAQ</title>-->
<!--    <style>-->
<!--        * { margin: 0; padding: 0; box-sizing: border-box; }-->
<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            height: 100vh;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--        }-->
<!--        .container {-->
<!--            width: 90%;-->
<!--            max-width: 800px;-->
<!--            height: 90vh;-->
<!--            background: white;-->
<!--            border-radius: 20px;-->
<!--            box-shadow: 0 20px 60px rgba(0,0,0,0.3);-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        .header {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .header h1 { font-size: 24px; margin-bottom: 5px; }-->
<!--        .header p { font-size: 14px; opacity: 0.9; }-->
<!--        .verify-section, .chat-section { padding: 20px; }-->
<!--        .verify-section {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            flex: 1;-->
<!--        }-->
<!--        .input-group {-->
<!--            width: 100%;-->
<!--            max-width: 400px;-->
<!--        }-->
<!--        .input-group label {-->
<!--            display: block;-->
<!--            margin-bottom: 8px;-->
<!--            color: #333;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .input-group input {-->
<!--            width: 100%;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        .btn {-->
<!--            padding: 12px 30px;-->
<!--            border: none;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s;-->
<!--        }-->
<!--        .btn-primary {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }-->
<!--        .btn-primary:disabled {-->
<!--            opacity: 0.6;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->
<!--        .chat-section {-->
<!--            display: none;-->
<!--            flex-direction: column;-->
<!--            flex: 1;-->
<!--            min-height: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        .chat-info {-->
<!--            background: #f8f9fa;-->
<!--            padding: 10px 15px;-->
<!--            border-radius: 0;-->
<!--            font-size: 14px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .messages {-->
<!--            flex: 1;-->
<!--            overflow-y: auto;-->
<!--            padding: 20px;-->
<!--            background: #f8f9fa;-->
<!--            min-height: 0;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar {-->
<!--            width: 8px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-track {-->
<!--            background: #f1f1f1;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb {-->
<!--            background: #888;-->
<!--            border-radius: 4px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb:hover {-->
<!--            background: #555;-->
<!--        }-->
<!--        .message {-->
<!--            margin-bottom: 15px;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            animation: slideIn 0.3s ease;-->
<!--        }-->
<!--        @keyframes slideIn {-->
<!--            from { opacity: 0; transform: translateY(10px); }-->
<!--            to { opacity: 1; transform: translateY(0); }-->
<!--        }-->
<!--        .message.user { justify-content: flex-end; }-->
<!--        .message-content {-->
<!--            max-width: 70%;-->
<!--            padding: 12px 16px;-->
<!--            border-radius: 12px;-->
<!--            line-height: 1.5;-->
<!--            white-space: pre-wrap;-->
<!--            word-wrap: break-word;-->
<!--        }-->
<!--        .message.bot .message-content {-->
<!--            background: white;-->
<!--            color: #333;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .message.user .message-content {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .input-area {-->
<!--            padding: 15px;-->
<!--            background: white;-->
<!--            border-top: 1px solid #ddd;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .input-area input {-->
<!--            flex: 1;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 25px;-->
<!--            font-size: 14px;-->
<!--        }-->
<!--        .upload-area {-->
<!--            padding: 15px;-->
<!--            background: #f8f9fa;-->
<!--            border-top: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .file-input-wrapper {-->
<!--            position: relative;-->
<!--            display: inline-block;-->
<!--        }-->
<!--        .file-input-wrapper input[type=file] {-->
<!--            position: absolute;-->
<!--            opacity: 0;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            cursor: pointer;-->
<!--            left: 0;-->
<!--            top: 0;-->
<!--        }-->
<!--        .loading {-->
<!--            text-align: center;-->
<!--            color: #666;-->
<!--            padding: 10px;-->
<!--            font-style: italic;-->
<!--        }-->
<!--        .error {-->
<!--            color: #dc3545;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #ffebee;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .success {-->
<!--            color: #28a745;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #e8f5e9;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .typing-indicator {-->
<!--            display: inline-block;-->
<!--            padding: 12px 16px;-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .typing-indicator span {-->
<!--            height: 8px;-->
<!--            width: 8px;-->
<!--            background: #667eea;-->
<!--            border-radius: 50%;-->
<!--            display: inline-block;-->
<!--            margin-right: 5px;-->
<!--            animation: bounce 1.4s infinite ease-in-out;-->
<!--        }-->
<!--        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }-->
<!--        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }-->
<!--        @keyframes bounce {-->
<!--            0%, 80%, 100% { transform: scale(0); }-->
<!--            40% { transform: scale(1); }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container">-->
<!--        <div class="header">-->
<!--            <h1>üè• AI Patient Education</h1>-->
<!--            <p>Get clear explanations for your medical documents and health questions</p>-->
<!--        </div>-->

<!--        &lt;!&ndash; Verification Section &ndash;&gt;-->
<!--        <div class="verify-section" id="verifySection">-->
<!--            <div class="input-group">-->
<!--                <label for="mobileNumber">Enter your mobile number</label>-->
<!--                <input type="tel" id="mobileNumber" placeholder="+91 1234567890" />-->
<!--            </div>-->
<!--            <button class="btn btn-primary" onclick="verifyPatient()">Verify & Continue</button>-->
<!--            <div id="verifyMessage"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Chat Section &ndash;&gt;-->
<!--        <div class="chat-section" id="chatSection">-->
<!--            <div class="chat-info" id="patientInfo"></div>-->
<!--            <div class="messages" id="messages"></div>-->
<!--            <div class="upload-area">-->
<!--                <div class="file-input-wrapper">-->
<!--                    <button class="btn btn-primary" id="uploadBtn">üìÑ Upload Medical Document (PDF)</button>-->
<!--                    <input type="file" id="fileInput" accept=".pdf" />-->
<!--                </div>-->
<!--                <div id="uploadStatus"></div>-->
<!--            </div>-->
<!--            <div class="input-area">-->
<!--                <input type="text" id="queryInput" placeholder="Ask a health question..."-->
<!--                       onkeypress="if(event.key==='Enter') sendQuery()" />-->
<!--                <button class="btn btn-primary" onclick="sendQuery()">Send</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script>-->
<!--        let patientId = null;-->
<!--        let patientName = null;-->
<!--        let sessionId = null;-->

<!--        // Setup file input listener after DOM loads-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            const fileInput = document.getElementById('fileInput');-->
<!--            if (fileInput) {-->
<!--                fileInput.addEventListener('change', uploadDocument);-->
<!--            }-->
<!--        });-->

<!--        async function verifyPatient() {-->
<!--            const mobile = document.getElementById('mobileNumber').value;-->
<!--            const msgDiv = document.getElementById('verifyMessage');-->

<!--            if (!mobile) {-->
<!--                msgDiv.innerHTML = '<p class="error">Please enter mobile number</p>';-->
<!--                return;-->
<!--            }-->

<!--            msgDiv.innerHTML = '<p class="loading">Verifying...</p>';-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/verify-patient', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({ mobile_number: mobile })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (data.verified) {-->
<!--                    patientId = data.patient_id;-->
<!--                    patientName = data.patient_name;-->
<!--                    document.getElementById('verifySection').style.display = 'none';-->
<!--                    document.getElementById('chatSection').style.display = 'flex';-->
<!--                    document.getElementById('patientInfo').innerHTML =-->
<!--                        `<strong>Welcome, ${patientName}!</strong> Ask questions or upload your medical documents.`;-->
<!--                    addMessage('bot', 'Hello! I can help explain your medical documents and answer health questions. How can I assist you today?');-->
<!--                } else {-->
<!--                    msgDiv.innerHTML = `<p class="error">${data.message}</p>`;-->
<!--                }-->
<!--            } catch (error) {-->
<!--                msgDiv.innerHTML = '<p class="error">Error verifying patient. Please try again.</p>';-->
<!--                console.error('Verification error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function sendQuery() {-->
<!--            const input = document.getElementById('queryInput');-->
<!--            const query = input.value.trim();-->

<!--            if (!query) return;-->

<!--            addMessage('user', query);-->
<!--            input.value = '';-->

<!--            // Show typing indicator-->
<!--            const typingId = addTypingIndicator();-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/chat/query', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({-->
<!--                        patient_id: patientId,-->
<!--                        query: query,-->
<!--                        session_id: sessionId-->
<!--                    })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                // Remove typing indicator-->
<!--                removeTypingIndicator(typingId);-->

<!--                sessionId = data.session_id;-->
<!--                addMessage('bot', data.response);-->
<!--            } catch (error) {-->
<!--                removeTypingIndicator(typingId);-->
<!--                addMessage('bot', 'Sorry, I encountered an error. Please try again.');-->
<!--                console.error('Query error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function uploadDocument(event) {-->
<!--            const file = event.target.files[0];-->
<!--            const statusDiv = document.getElementById('uploadStatus');-->
<!--            const uploadBtn = document.getElementById('uploadBtn');-->

<!--            if (!file) return;-->

<!--            // Validate file type-->
<!--            if (file.type !== 'application/pdf') {-->
<!--                statusDiv.innerHTML = '<p class="error">Please upload a PDF file only</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            // Validate file size (10MB)-->
<!--            if (file.size > 10 * 1024 * 1024) {-->
<!--                statusDiv.innerHTML = '<p class="error">File size must be less than 10MB</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            uploadBtn.disabled = true;-->
<!--            addMessage('user', `üìÑ Uploaded: ${file.name}`);-->

<!--            // Step 1: Uploading-->
<!--            updateUploadStatus(statusDiv, '‚¨ÜÔ∏è Uploading document...', 'loading');-->

<!--            const formData = new FormData();-->
<!--            formData.append('file', file);-->
<!--            formData.append('patient_id', patientId);-->

<!--            try {-->
<!--                // Step 2: Extracting text-->
<!--                setTimeout(() => updateUploadStatus(statusDiv, 'üìÑ Extracting text from PDF...', 'loading'), 500);-->

<!--                const response = await fetch('/api/v1/chat/upload-document', {-->
<!--                    method: 'POST',-->
<!--                    body: formData-->
<!--                });-->

<!--                if (!response.ok) {-->
<!--                    throw new Error(`Upload failed: ${response.status}`);-->
<!--                }-->

<!--                const data = await response.json();-->

<!--                if (data.success) {-->
<!--                    // Step 3: Processing-->
<!--                    updateUploadStatus(statusDiv, 'üîÑ Converting to standard format...', 'loading');-->
<!--                    await sleep(800);-->

<!--                    // Step 4: Generating explanation-->
<!--                    updateUploadStatus(statusDiv, 'ü§ñ Generating patient-friendly explanation...', 'loading');-->
<!--                    await sleep(1000);-->

<!--                    // Step 5: Success-->
<!--                    updateUploadStatus(statusDiv, '‚úì Document processed successfully!', 'success');-->
<!--                    addMessage('bot', data.explanation);-->

<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                } else {-->
<!--                    updateUploadStatus(statusDiv, `‚ùå ${data.message}`, 'error');-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                }-->
<!--            } catch (error) {-->
<!--                updateUploadStatus(statusDiv, '‚ùå Error uploading document. Please try again.', 'error');-->
<!--                console.error('Upload error:', error);-->
<!--                setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--            } finally {-->
<!--                uploadBtn.disabled = false;-->
<!--                event.target.value = '';-->
<!--            }-->
<!--        }-->

<!--        function updateUploadStatus(statusDiv, message, type) {-->
<!--            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'loading';-->
<!--            statusDiv.innerHTML = `<p class="${className}">${message}</p>`;-->
<!--        }-->

<!--        function sleep(ms) {-->
<!--            return new Promise(resolve => setTimeout(resolve, ms));-->
<!--        }-->

<!--        function addMessage(type, text) {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const messageDiv = document.createElement('div');-->
<!--            messageDiv.className = `message ${type}`;-->
<!--            messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;-->
<!--            messagesDiv.appendChild(messageDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--        }-->

<!--        function addTypingIndicator() {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const typingDiv = document.createElement('div');-->
<!--            const typingId = 'typing-' + Date.now();-->
<!--            typingDiv.id = typingId;-->
<!--            typingDiv.className = 'message bot';-->
<!--            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';-->
<!--            messagesDiv.appendChild(typingDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--            return typingId;-->
<!--        }-->

<!--        function removeTypingIndicator(typingId) {-->
<!--            const typingDiv = document.getElementById(typingId);-->
<!--            if (typingDiv) {-->
<!--                typingDiv.remove();-->
<!--            }-->
<!--        }-->

<!--        function escapeHtml(text) {-->
<!--            const div = document.createElement('div');-->
<!--            div.textContent = text;-->
<!--            return div.innerHTML;-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->

<!--version three working-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>AI Patient Education & FAQ</title>-->
<!--    <style>-->
<!--        * { margin: 0; padding: 0; box-sizing: border-box; }-->
<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            height: 100vh;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--        }-->
<!--        .container {-->
<!--            width: 90%;-->
<!--            max-width: 800px;-->
<!--            height: 90vh;-->
<!--            background: white;-->
<!--            border-radius: 20px;-->
<!--            box-shadow: 0 20px 60px rgba(0,0,0,0.3);-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        .header {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .header h1 { font-size: 24px; margin-bottom: 5px; }-->
<!--        .header p { font-size: 14px; opacity: 0.9; }-->
<!--        .verify-section, .chat-section { padding: 20px; }-->
<!--        .verify-section {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            flex: 1;-->
<!--        }-->
<!--        .input-group {-->
<!--            width: 100%;-->
<!--            max-width: 400px;-->
<!--        }-->
<!--        .input-group label {-->
<!--            display: block;-->
<!--            margin-bottom: 8px;-->
<!--            color: #333;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .input-group input {-->
<!--            width: 100%;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        .btn {-->
<!--            padding: 12px 30px;-->
<!--            border: none;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s;-->
<!--        }-->
<!--        .btn-primary {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }-->
<!--        .btn-primary:disabled {-->
<!--            opacity: 0.6;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->
<!--        .chat-section {-->
<!--            display: none;-->
<!--            flex-direction: column;-->
<!--            flex: 1;-->
<!--            min-height: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        .chat-info {-->
<!--            background: #f8f9fa;-->
<!--            padding: 10px 15px;-->
<!--            border-radius: 0;-->
<!--            font-size: 14px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .messages {-->
<!--            flex: 1;-->
<!--            overflow-y: auto;-->
<!--            padding: 20px;-->
<!--            background: #f8f9fa;-->
<!--            min-height: 0;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar {-->
<!--            width: 8px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-track {-->
<!--            background: #f1f1f1;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb {-->
<!--            background: #888;-->
<!--            border-radius: 4px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb:hover {-->
<!--            background: #555;-->
<!--        }-->
<!--        .message {-->
<!--            margin-bottom: 15px;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            animation: slideIn 0.3s ease;-->
<!--        }-->
<!--        @keyframes slideIn {-->
<!--            from { opacity: 0; transform: translateY(10px); }-->
<!--            to { opacity: 1; transform: translateY(0); }-->
<!--        }-->
<!--        .message.user { justify-content: flex-end; }-->
<!--        .message-content {-->
<!--            max-width: 70%;-->
<!--            padding: 12px 16px;-->
<!--            border-radius: 12px;-->
<!--            line-height: 1.5;-->
<!--            white-space: pre-wrap;-->
<!--            word-wrap: break-word;-->
<!--        }-->
<!--        .message.bot .message-content {-->
<!--            background: white;-->
<!--            color: #333;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .message.user .message-content {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .input-area {-->
<!--            padding: 15px;-->
<!--            background: white;-->
<!--            border-top: 1px solid #ddd;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .input-area input {-->
<!--            flex: 1;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 25px;-->
<!--            font-size: 14px;-->
<!--        }-->
<!--        .upload-area {-->
<!--            padding: 15px;-->
<!--            background: #f8f9fa;-->
<!--            border-top: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .file-input-wrapper {-->
<!--            position: relative;-->
<!--            display: inline-block;-->
<!--        }-->
<!--        .file-input-wrapper input[type=file] {-->
<!--            position: absolute;-->
<!--            opacity: 0;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            cursor: pointer;-->
<!--            left: 0;-->
<!--            top: 0;-->
<!--        }-->
<!--        .loading {-->
<!--            text-align: center;-->
<!--            color: #666;-->
<!--            padding: 10px;-->
<!--            font-style: italic;-->
<!--        }-->
<!--        .error {-->
<!--            color: #dc3545;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #ffebee;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .success {-->
<!--            color: #28a745;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #e8f5e9;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .typing-indicator {-->
<!--            display: inline-block;-->
<!--            padding: 12px 16px;-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .typing-indicator span {-->
<!--            height: 8px;-->
<!--            width: 8px;-->
<!--            background: #667eea;-->
<!--            border-radius: 50%;-->
<!--            display: inline-block;-->
<!--            margin-right: 5px;-->
<!--            animation: bounce 1.4s infinite ease-in-out;-->
<!--        }-->
<!--        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }-->
<!--        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }-->
<!--        @keyframes bounce {-->
<!--            0%, 80%, 100% { transform: scale(0); }-->
<!--            40% { transform: scale(1); }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container">-->
<!--        <div class="header">-->
<!--            <h1>üè• AI Patient Education</h1>-->
<!--            <p>Get clear explanations for your medical documents and health questions</p>-->
<!--        </div>-->

<!--        &lt;!&ndash; Verification Section &ndash;&gt;-->
<!--        <div class="verify-section" id="verifySection">-->
<!--            <div class="input-group">-->
<!--                <label for="mobileNumber">Enter your mobile number</label>-->
<!--                <input type="tel" id="mobileNumber" placeholder="+91 1234567890" />-->
<!--            </div>-->
<!--            <button class="btn btn-primary" onclick="verifyPatient()">Verify & Continue</button>-->
<!--            <div id="verifyMessage"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Chat Section &ndash;&gt;-->
<!--        <div class="chat-section" id="chatSection">-->
<!--            <div class="chat-info" id="patientInfo"></div>-->
<!--            <div class="messages" id="messages"></div>-->
<!--            <div class="upload-area">-->
<!--                <div class="file-input-wrapper">-->
<!--                    <button class="btn btn-primary" id="uploadBtn">üìÑ Upload Medical Document (PDF)</button>-->
<!--                    <input type="file" id="fileInput" accept=".pdf" />-->
<!--                </div>-->
<!--                <div id="uploadStatus"></div>-->
<!--            </div>-->
<!--            <div class="input-area">-->
<!--                <input type="text" id="queryInput" placeholder="Ask a health question..."-->
<!--                       onkeypress="if(event.key==='Enter') sendQuery()" />-->
<!--                <button class="btn btn-primary" onclick="sendQuery()">Send</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script>-->
<!--        let patientId = null;-->
<!--        let patientName = null;-->
<!--        let sessionId = null;-->

<!--        // Setup file input listener after DOM loads-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            const fileInput = document.getElementById('fileInput');-->
<!--            if (fileInput) {-->
<!--                fileInput.addEventListener('change', uploadDocument);-->
<!--            }-->
<!--        });-->

<!--        async function verifyPatient() {-->
<!--            const mobile = document.getElementById('mobileNumber').value;-->
<!--            const msgDiv = document.getElementById('verifyMessage');-->

<!--            if (!mobile) {-->
<!--                msgDiv.innerHTML = '<p class="error">Please enter mobile number</p>';-->
<!--                return;-->
<!--            }-->

<!--            msgDiv.innerHTML = '<p class="loading">Verifying...</p>';-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/verify-patient', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({ mobile_number: mobile })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (data.verified) {-->
<!--                    patientId = data.patient_id;-->
<!--                    patientName = data.patient_name;-->
<!--                    document.getElementById('verifySection').style.display = 'none';-->
<!--                    document.getElementById('chatSection').style.display = 'flex';-->
<!--                    document.getElementById('patientInfo').innerHTML =-->
<!--                        `<strong>Welcome, ${patientName}!</strong> Ask questions or upload your medical documents.`;-->
<!--                    addMessage('bot', 'Hello! I can help explain your medical documents and answer health questions. How can I assist you today?');-->
<!--                } else {-->
<!--                    msgDiv.innerHTML = `<p class="error">${data.message}</p>`;-->
<!--                }-->
<!--            } catch (error) {-->
<!--                msgDiv.innerHTML = '<p class="error">Error verifying patient. Please try again.</p>';-->
<!--                console.error('Verification error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function sendQuery() {-->
<!--            const input = document.getElementById('queryInput');-->
<!--            const query = input.value.trim();-->

<!--            if (!query) return;-->

<!--            addMessage('user', query);-->
<!--            input.value = '';-->

<!--            // Show typing indicator-->
<!--            const typingId = addTypingIndicator();-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/chat/query', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({-->
<!--                        patient_id: patientId,-->
<!--                        query: query,-->
<!--                        session_id: sessionId-->
<!--                    })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                // Remove typing indicator-->
<!--                removeTypingIndicator(typingId);-->

<!--                sessionId = data.session_id;-->
<!--                addMessage('bot', data.response);-->
<!--            } catch (error) {-->
<!--                removeTypingIndicator(typingId);-->
<!--                addMessage('bot', 'Sorry, I encountered an error. Please try again.');-->
<!--                console.error('Query error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function uploadDocument(event) {-->
<!--            const file = event.target.files[0];-->
<!--            const statusDiv = document.getElementById('uploadStatus');-->
<!--            const uploadBtn = document.getElementById('uploadBtn');-->

<!--            if (!file) return;-->

<!--            // Validate file type-->
<!--            if (file.type !== 'application/pdf') {-->
<!--                statusDiv.innerHTML = '<p class="error">Please upload a PDF file only</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            // Validate file size (10MB)-->
<!--            if (file.size > 10 * 1024 * 1024) {-->
<!--                statusDiv.innerHTML = '<p class="error">File size must be less than 10MB</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            uploadBtn.disabled = true;-->
<!--            addMessage('user', `üìÑ Uploaded: ${file.name}`);-->

<!--            // Step 1: Uploading-->
<!--            updateUploadStatus(statusDiv, '‚¨ÜÔ∏è Uploading document...', 'loading');-->

<!--            const formData = new FormData();-->
<!--            formData.append('file', file);-->
<!--            formData.append('patient_id', patientId);-->

<!--            try {-->
<!--                // Step 2: Extracting text-->
<!--                setTimeout(() => updateUploadStatus(statusDiv, 'üìÑ Extracting text from PDF...', 'loading'), 500);-->

<!--                const response = await fetch('/api/v1/chat/upload-document', {-->
<!--                    method: 'POST',-->
<!--                    body: formData-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (!response.ok) {-->
<!--                    // Show detailed error from backend-->
<!--                    const errorMsg = data.detail || `Upload failed: ${response.status}`;-->
<!--                    updateUploadStatus(statusDiv, `‚ùå ${errorMsg}`, 'error');-->
<!--                    console.error('Backend error:', data);-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 8000);-->
<!--                    uploadBtn.disabled = false;-->
<!--                    event.target.value = '';-->
<!--                    return;-->
<!--                }-->

<!--                if (data.success) {-->
<!--                    // Step 3: Processing-->
<!--                    updateUploadStatus(statusDiv, 'üîÑ Converting to standard format...', 'loading');-->
<!--                    await sleep(800);-->

<!--                    // Step 4: Generating explanation-->
<!--                    updateUploadStatus(statusDiv, 'ü§ñ Generating patient-friendly explanation...', 'loading');-->
<!--                    await sleep(1000);-->

<!--                    // Step 5: Success-->
<!--                    updateUploadStatus(statusDiv, '‚úì Document processed successfully!', 'success');-->
<!--                    addMessage('bot', data.explanation);-->

<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                } else {-->
<!--                    updateUploadStatus(statusDiv, `‚ùå ${data.message}`, 'error');-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                }-->
<!--            } catch (error) {-->
<!--                updateUploadStatus(statusDiv, '‚ùå Error uploading document. Please try again.', 'error');-->
<!--                console.error('Upload error:', error);-->
<!--                setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--            } finally {-->
<!--                uploadBtn.disabled = false;-->
<!--                event.target.value = '';-->
<!--            }-->
<!--        }-->

<!--        function updateUploadStatus(statusDiv, message, type) {-->
<!--            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'loading';-->
<!--            statusDiv.innerHTML = `<p class="${className}">${message}</p>`;-->
<!--        }-->

<!--        function sleep(ms) {-->
<!--            return new Promise(resolve => setTimeout(resolve, ms));-->
<!--        }-->

<!--        function addMessage(type, text) {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const messageDiv = document.createElement('div');-->
<!--            messageDiv.className = `message ${type}`;-->
<!--            messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;-->
<!--            messagesDiv.appendChild(messageDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--        }-->

<!--        function addTypingIndicator() {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const typingDiv = document.createElement('div');-->
<!--            const typingId = 'typing-' + Date.now();-->
<!--            typingDiv.id = typingId;-->
<!--            typingDiv.className = 'message bot';-->
<!--            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';-->
<!--            messagesDiv.appendChild(typingDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--            return typingId;-->
<!--        }-->

<!--        function removeTypingIndicator(typingId) {-->
<!--            const typingDiv = document.getElementById(typingId);-->
<!--            if (typingDiv) {-->
<!--                typingDiv.remove();-->
<!--            }-->
<!--        }-->

<!--        function escapeHtml(text) {-->
<!--            const div = document.createElement('div');-->
<!--            div.textContent = text;-->
<!--            return div.innerHTML;-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->

<!--version four for voice integration-->
<!--&lt;!&ndash;working one commented it for new ui&ndash;&gt;-->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>AI Patient Education & FAQ</title>-->
<!--    <style>-->
<!--        * { margin: 0; padding: 0; box-sizing: border-box; }-->
<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            height: 100vh;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--        }-->
<!--        .container {-->
<!--            width: 90%;-->
<!--            max-width: 800px;-->
<!--            height: 90vh;-->
<!--            background: white;-->
<!--            border-radius: 20px;-->
<!--            box-shadow: 0 20px 60px rgba(0,0,0,0.3);-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        .header {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .header h1 { font-size: 24px; margin-bottom: 5px; }-->
<!--        .header p { font-size: 14px; opacity: 0.9; }-->
<!--        .mode-switch {-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            gap: 10px;-->
<!--            margin-top: 15px;-->
<!--        }-->
<!--        .mode-btn {-->
<!--            padding: 8px 20px;-->
<!--            border: 2px solid white;-->
<!--            background: transparent;-->
<!--            color: white;-->
<!--            border-radius: 20px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s;-->
<!--            font-size: 14px;-->
<!--        }-->
<!--        .mode-btn.active {-->
<!--            background: white;-->
<!--            color: #667eea;-->
<!--        }-->
<!--        .mode-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--        }-->
<!--        .verify-section, .chat-section { padding: 20px; }-->
<!--        .verify-section {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            flex: 1;-->
<!--        }-->
<!--        .input-group {-->
<!--            width: 100%;-->
<!--            max-width: 400px;-->
<!--        }-->
<!--        .input-group label {-->
<!--            display: block;-->
<!--            margin-bottom: 8px;-->
<!--            color: #333;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .input-group input {-->
<!--            width: 100%;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        .btn {-->
<!--            padding: 12px 30px;-->
<!--            border: none;-->
<!--            border-radius: 8px;-->
<!--            font-size: 16px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s;-->
<!--        }-->
<!--        .btn-primary {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }-->
<!--        .btn-primary:disabled {-->
<!--            opacity: 0.6;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->
<!--        .chat-section {-->
<!--            display: none;-->
<!--            flex-direction: column;-->
<!--            flex: 1;-->
<!--            min-height: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        .chat-info {-->
<!--            background: #f8f9fa;-->
<!--            padding: 10px 15px;-->
<!--            border-radius: 0;-->
<!--            font-size: 14px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .messages {-->
<!--            flex: 1;-->
<!--            overflow-y: auto;-->
<!--            padding: 20px;-->
<!--            background: #f8f9fa;-->
<!--            min-height: 0;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar {-->
<!--            width: 8px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-track {-->
<!--            background: #f1f1f1;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb {-->
<!--            background: #888;-->
<!--            border-radius: 4px;-->
<!--        }-->
<!--        .messages::-webkit-scrollbar-thumb:hover {-->
<!--            background: #555;-->
<!--        }-->
<!--        .message {-->
<!--            margin-bottom: 15px;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            animation: slideIn 0.3s ease;-->
<!--        }-->
<!--        @keyframes slideIn {-->
<!--            from { opacity: 0; transform: translateY(10px); }-->
<!--            to { opacity: 1; transform: translateY(0); }-->
<!--        }-->
<!--        .message.user { justify-content: flex-end; }-->
<!--        .message-content {-->
<!--            max-width: 70%;-->
<!--            padding: 12px 16px;-->
<!--            border-radius: 12px;-->
<!--            line-height: 1.5;-->
<!--            white-space: pre-wrap;-->
<!--            word-wrap: break-word;-->
<!--        }-->
<!--        .message.bot .message-content {-->
<!--            background: white;-->
<!--            color: #333;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .message.user .message-content {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            color: white;-->
<!--        }-->
<!--        .input-area {-->
<!--            padding: 15px;-->
<!--            background: white;-->
<!--            border-top: 1px solid #ddd;-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .input-area input {-->
<!--            flex: 1;-->
<!--            padding: 12px;-->
<!--            border: 2px solid #ddd;-->
<!--            border-radius: 25px;-->
<!--            font-size: 14px;-->
<!--        }-->
<!--        .upload-area {-->
<!--            padding: 15px;-->
<!--            background: #f8f9fa;-->
<!--            border-top: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--            flex-shrink: 0;-->
<!--        }-->
<!--        .file-input-wrapper {-->
<!--            position: relative;-->
<!--            display: inline-block;-->
<!--        }-->
<!--        .file-input-wrapper input[type=file] {-->
<!--            position: absolute;-->
<!--            opacity: 0;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            cursor: pointer;-->
<!--            left: 0;-->
<!--            top: 0;-->
<!--        }-->
<!--        .loading {-->
<!--            text-align: center;-->
<!--            color: #666;-->
<!--            padding: 10px;-->
<!--            font-style: italic;-->
<!--        }-->
<!--        .error {-->
<!--            color: #dc3545;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #ffebee;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .success {-->
<!--            color: #28a745;-->
<!--            padding: 10px;-->
<!--            text-align: center;-->
<!--            background: #e8f5e9;-->
<!--            border-radius: 5px;-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        .typing-indicator {-->
<!--            display: inline-block;-->
<!--            padding: 12px 16px;-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 2px 5px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .typing-indicator span {-->
<!--            height: 8px;-->
<!--            width: 8px;-->
<!--            background: #667eea;-->
<!--            border-radius: 50%;-->
<!--            display: inline-block;-->
<!--            margin-right: 5px;-->
<!--            animation: bounce 1.4s infinite ease-in-out;-->
<!--        }-->
<!--        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }-->
<!--        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }-->
<!--        @keyframes bounce {-->
<!--            0%, 80%, 100% { transform: scale(0); }-->
<!--            40% { transform: scale(1); }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container">-->
<!--        <div class="header">-->
<!--            <h1>üè• AI Patient Education</h1>-->
<!--            <p>Get clear explanations for your medical documents and health questions</p>-->
<!--            <div class="mode-switch">-->
<!--                <button class="mode-btn" onclick="window.location.href='/static/voice.html'">üé§ Voice</button>-->
<!--                <button class="mode-btn active" onclick="switchMode('chat')">üí¨ Chat</button>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Verification Section &ndash;&gt;-->
<!--        <div class="verify-section" id="verifySection">-->
<!--            <div class="input-group">-->
<!--                <label for="mobileNumber">Enter your mobile number</label>-->
<!--                <input type="tel" id="mobileNumber" placeholder="+91 1234567890" />-->
<!--            </div>-->
<!--            <button class="btn btn-primary" onclick="verifyPatient()">Verify & Continue</button>-->
<!--            <div id="verifyMessage"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Chat Section &ndash;&gt;-->
<!--        <div class="chat-section" id="chatSection">-->
<!--            <div class="chat-info" id="patientInfo"></div>-->
<!--            <div class="messages" id="messages"></div>-->
<!--            <div class="upload-area">-->
<!--                <div class="file-input-wrapper">-->
<!--                    <button class="btn btn-primary" id="uploadBtn">üìÑ Upload Medical Document (PDF)</button>-->
<!--                    <input type="file" id="fileInput" accept=".pdf" />-->
<!--                </div>-->
<!--                <div id="uploadStatus"></div>-->
<!--            </div>-->
<!--            <div class="input-area">-->
<!--                <input type="text" id="queryInput" placeholder="Ask a health question..."-->
<!--                       onkeypress="if(event.key==='Enter') sendQuery()" />-->
<!--                <button class="btn btn-primary" onclick="sendQuery()">Send</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script>-->
<!--        let patientId = null;-->
<!--        let patientName = null;-->
<!--        let sessionId = null;-->

<!--        function switchMode(mode) {-->
<!--            // Stay on current page-->
<!--        }-->

<!--        // Setup file input listener after DOM loads-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            const fileInput = document.getElementById('fileInput');-->
<!--            if (fileInput) {-->
<!--                fileInput.addEventListener('change', uploadDocument);-->
<!--            }-->
<!--        });-->

<!--        async function verifyPatient() {-->
<!--            const mobile = document.getElementById('mobileNumber').value;-->
<!--            const msgDiv = document.getElementById('verifyMessage');-->

<!--            if (!mobile) {-->
<!--                msgDiv.innerHTML = '<p class="error">Please enter mobile number</p>';-->
<!--                return;-->
<!--            }-->

<!--            msgDiv.innerHTML = '<p class="loading">Verifying...</p>';-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/verify-patient', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({ mobile_number: mobile })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (data.verified) {-->
<!--                    patientId = data.patient_id;-->
<!--                    patientName = data.patient_name;-->
<!--                    document.getElementById('verifySection').style.display = 'none';-->
<!--                    document.getElementById('chatSection').style.display = 'flex';-->
<!--                    document.getElementById('patientInfo').innerHTML =-->
<!--                        `<strong>Welcome, ${patientName}!</strong> Ask questions or upload your medical documents.`;-->
<!--                    addMessage('bot', 'Hello! I can help explain your medical documents and answer health questions. How can I assist you today?');-->
<!--                } else {-->
<!--                    msgDiv.innerHTML = `<p class="error">${data.message}</p>`;-->
<!--                }-->
<!--            } catch (error) {-->
<!--                msgDiv.innerHTML = '<p class="error">Error verifying patient. Please try again.</p>';-->
<!--                console.error('Verification error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function sendQuery() {-->
<!--            const input = document.getElementById('queryInput');-->
<!--            const query = input.value.trim();-->

<!--            if (!query) return;-->

<!--            addMessage('user', query);-->
<!--            input.value = '';-->

<!--            // Show typing indicator-->
<!--            const typingId = addTypingIndicator();-->

<!--            try {-->
<!--                const response = await fetch('/api/v1/chat/query', {-->
<!--                    method: 'POST',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({-->
<!--                        patient_id: patientId,-->
<!--                        query: query,-->
<!--                        session_id: sessionId-->
<!--                    })-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                // Remove typing indicator-->
<!--                removeTypingIndicator(typingId);-->

<!--                sessionId = data.session_id;-->
<!--                addMessage('bot', data.response);-->
<!--            } catch (error) {-->
<!--                removeTypingIndicator(typingId);-->
<!--                addMessage('bot', 'Sorry, I encountered an error. Please try again.');-->
<!--                console.error('Query error:', error);-->
<!--            }-->
<!--        }-->

<!--        async function uploadDocument(event) {-->
<!--            const file = event.target.files[0];-->
<!--            const statusDiv = document.getElementById('uploadStatus');-->
<!--            const uploadBtn = document.getElementById('uploadBtn');-->

<!--            if (!file) return;-->

<!--            // Validate file type-->
<!--            if (file.type !== 'application/pdf') {-->
<!--                statusDiv.innerHTML = '<p class="error">Please upload a PDF file only</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            // Validate file size (10MB)-->
<!--            if (file.size > 10 * 1024 * 1024) {-->
<!--                statusDiv.innerHTML = '<p class="error">File size must be less than 10MB</p>';-->
<!--                event.target.value = '';-->
<!--                return;-->
<!--            }-->

<!--            uploadBtn.disabled = true;-->
<!--            addMessage('user', `üìÑ Uploaded: ${file.name}`);-->

<!--            // Step 1: Uploading-->
<!--            updateUploadStatus(statusDiv, '‚¨ÜÔ∏è Uploading document...', 'loading');-->

<!--            const formData = new FormData();-->
<!--            formData.append('file', file);-->
<!--            formData.append('patient_id', patientId);-->

<!--            try {-->
<!--                // Step 2: Extracting text-->
<!--                setTimeout(() => updateUploadStatus(statusDiv, 'üìÑ Extracting text from PDF...', 'loading'), 500);-->

<!--                const response = await fetch('/api/v1/chat/upload-document', {-->
<!--                    method: 'POST',-->
<!--                    body: formData-->
<!--                });-->

<!--                const data = await response.json();-->

<!--                if (!response.ok) {-->
<!--                    // Show detailed error from backend-->
<!--                    const errorMsg = data.detail || `Upload failed: ${response.status}`;-->
<!--                    updateUploadStatus(statusDiv, `‚ùå ${errorMsg}`, 'error');-->
<!--                    console.error('Backend error:', data);-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 8000);-->
<!--                    uploadBtn.disabled = false;-->
<!--                    event.target.value = '';-->
<!--                    return;-->
<!--                }-->

<!--                if (data.success) {-->
<!--                    // Step 3: Processing-->
<!--                    updateUploadStatus(statusDiv, 'üîÑ Converting to standard format...', 'loading');-->
<!--                    await sleep(800);-->

<!--                    // Step 4: Generating explanation-->
<!--                    updateUploadStatus(statusDiv, 'ü§ñ Generating patient-friendly explanation...', 'loading');-->
<!--                    await sleep(1000);-->

<!--                    // Step 5: Success-->
<!--                    updateUploadStatus(statusDiv, '‚úì Document processed successfully!', 'success');-->
<!--                    addMessage('bot', data.explanation);-->

<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                } else {-->
<!--                    updateUploadStatus(statusDiv, `‚ùå ${data.message}`, 'error');-->
<!--                    setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--                }-->
<!--            } catch (error) {-->
<!--                updateUploadStatus(statusDiv, '‚ùå Error uploading document. Please try again.', 'error');-->
<!--                console.error('Upload error:', error);-->
<!--                setTimeout(() => statusDiv.innerHTML = '', 5000);-->
<!--            } finally {-->
<!--                uploadBtn.disabled = false;-->
<!--                event.target.value = '';-->
<!--            }-->
<!--        }-->

<!--        function updateUploadStatus(statusDiv, message, type) {-->
<!--            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'loading';-->
<!--            statusDiv.innerHTML = `<p class="${className}">${message}</p>`;-->
<!--        }-->

<!--        function sleep(ms) {-->
<!--            return new Promise(resolve => setTimeout(resolve, ms));-->
<!--        }-->

<!--        function addMessage(type, text) {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const messageDiv = document.createElement('div');-->
<!--            messageDiv.className = `message ${type}`;-->
<!--            messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;-->
<!--            messagesDiv.appendChild(messageDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--        }-->

<!--        function addTypingIndicator() {-->
<!--            const messagesDiv = document.getElementById('messages');-->
<!--            const typingDiv = document.createElement('div');-->
<!--            const typingId = 'typing-' + Date.now();-->
<!--            typingDiv.id = typingId;-->
<!--            typingDiv.className = 'message bot';-->
<!--            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';-->
<!--            messagesDiv.appendChild(typingDiv);-->
<!--            messagesDiv.scrollTop = messagesDiv.scrollHeight;-->
<!--            return typingId;-->
<!--        }-->

<!--        function removeTypingIndicator(typingId) {-->
<!--            const typingDiv = document.getElementById(typingId);-->
<!--            if (typingDiv) {-->
<!--                typingDiv.remove();-->
<!--            }-->
<!--        }-->

<!--        function escapeHtml(text) {-->
<!--            const div = document.createElement('div');-->
<!--            div.textContent = text;-->
<!--            return div.innerHTML;-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->


<!--&lt;!&ndash;new ui but uploading logic was not included&ndash;&gt;-->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--<meta charset="UTF-8" />-->
<!--<meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--<title>Medilligence ‚Ä¢ AI Patient Education</title>-->

<!--<style>-->
<!--* { margin: 0; padding: 0; box-sizing: border-box; }-->

<!--body {-->
<!--    font-family: "Segoe UI", system-ui, sans-serif;-->
<!--    background: #f4f7fb;-->
<!--    height: 100vh;-->
<!--    display: flex;-->
<!--    justify-content: center;-->
<!--    align-items: center;-->
<!--}-->

<!--/* Container */-->
<!--.chat-container {-->
<!--    width: 100%;-->
<!--    max-width: 820px;-->
<!--    height: 92vh;-->
<!--    background: #ffffff;-->
<!--    border-radius: 18px;-->
<!--    box-shadow: 0 18px 40px rgba(0,0,0,0.12);-->
<!--    display: flex;-->
<!--    flex-direction: column;-->
<!--    overflow: hidden;-->
<!--}-->

<!--/* Header */-->
<!--.chat-header {-->
<!--    background: #2563eb;-->
<!--    color: white;-->
<!--    padding: 18px 24px;-->
<!--}-->

<!--.chat-header h1 {-->
<!--    font-size: 20px;-->
<!--    font-weight: 600;-->
<!--}-->

<!--.chat-header p {-->
<!--    font-size: 13px;-->
<!--    opacity: 0.9;-->
<!--    margin-top: 4px;-->
<!--}-->

<!--/* Messages */-->
<!--.chat-messages {-->
<!--    flex: 1;-->
<!--    padding: 22px;-->
<!--    background: #f9fafb;-->
<!--    overflow-y: auto;-->
<!--}-->

<!--.message {-->
<!--    display: flex;-->
<!--    margin-bottom: 14px;-->
<!--}-->

<!--.message.user { justify-content: flex-end; }-->
<!--.message.bot { justify-content: flex-start; }-->

<!--.bubble {-->
<!--    max-width: 70%;-->
<!--    padding: 12px 16px;-->
<!--    border-radius: 16px;-->
<!--    font-size: 14px;-->
<!--    line-height: 1.5;-->
<!--}-->

<!--.message.user .bubble {-->
<!--    background: #2563eb;-->
<!--    color: white;-->
<!--    border-bottom-right-radius: 4px;-->
<!--}-->

<!--.message.bot .bubble {-->
<!--    background: #eef2f7;-->
<!--    color: #1f2937;-->
<!--    border-bottom-left-radius: 4px;-->
<!--}-->

<!--/* Input Area */-->
<!--.chat-input-container {-->
<!--    border-top: 1px solid #e5e7eb;-->
<!--    padding: 14px 18px;-->
<!--    background: #ffffff;-->
<!--}-->

<!--.chat-input-wrapper {-->
<!--    display: flex;-->
<!--    align-items: center;-->
<!--    gap: 10px;-->
<!--}-->

<!--.icon-btn {-->
<!--    width: 40px;-->
<!--    height: 40px;-->
<!--    border-radius: 50%;-->
<!--    border: none;-->
<!--    background: #e0e7ff;-->
<!--    color: #2563eb;-->
<!--    cursor: pointer;-->
<!--    font-size: 18px;-->
<!--}-->

<!--.chat-input {-->
<!--    flex: 1;-->
<!--    padding: 12px 16px;-->
<!--    border: 1px solid #d1d5db;-->
<!--    border-radius: 22px;-->
<!--    font-size: 14px;-->
<!--    outline: none;-->
<!--}-->

<!--.chat-input:focus {-->
<!--    border-color: #2563eb;-->
<!--}-->

<!--.send-btn {-->
<!--    width: 42px;-->
<!--    height: 42px;-->
<!--    border-radius: 50%;-->
<!--    border: none;-->
<!--    background: #2563eb;-->
<!--    color: white;-->
<!--    cursor: pointer;-->
<!--    font-size: 16px;-->
<!--}-->

<!--/* Hidden file input */-->
<!--#fileInput { display: none; }-->

<!--/* Status */-->
<!--.status {-->
<!--    font-size: 12px;-->
<!--    color: #6b7280;-->
<!--    margin-top: 6px;-->
<!--}-->
<!--</style>-->
<!--</head>-->

<!--<body>-->

<!--<div class="chat-container">-->

<!--    &lt;!&ndash; Header &ndash;&gt;-->
<!--    <div class="chat-header">-->
<!--        <h1>Medilligence</h1>-->
<!--        <p>AI Patient Education</p>-->
<!--    </div>-->

<!--    &lt;!&ndash; Messages &ndash;&gt;-->
<!--    <div class="chat-messages" id="messages">-->
<!--        <div class="message bot">-->
<!--            <div class="bubble">-->
<!--                To keep your health information secure, please enter your registered mobile number to continue.-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Input &ndash;&gt;-->
<!--    <div class="chat-input-container">-->
<!--        <div class="chat-input-wrapper">-->
<!--            <button class="mic-button" onclick="goToVoice()">üé§</button>-->

<!--            <input-->
<!--                type="text"-->
<!--                id="chatInput"-->
<!--                class="chat-input"-->
<!--                placeholder="Enter mobile number or ask a question‚Ä¶"-->
<!--            />-->

<!--            <button class="icon-btn" onclick="document.getElementById('fileInput').click()">üìé</button>-->
<!--            <input type="file" id="fileInput" accept=".pdf" />-->

<!--            <button class="send-btn" onclick="sendMessage()">üöÄ</button>-->
<!--        </div>-->
<!--        <div class="status" id="status"></div>-->
<!--    </div>-->

<!--</div>-->

<!--<script>-->
<!--let patientId = null;-->
<!--let patientName = null;-->
<!--let sessionId = null;-->
<!--let verified = false;-->

<!--const messages = document.getElementById("messages");-->
<!--const input = document.getElementById("chatInput");-->
<!--const statusEl = document.getElementById("status");-->
<!--const fileInput = document.getElementById("fileInput");-->

<!--function addMessage(type, text) {-->
<!--    const msg = document.createElement("div");-->
<!--    msg.className = `message ${type}`;-->
<!--    msg.innerHTML = `<div class="bubble">${text}</div>`;-->
<!--    messages.appendChild(msg);-->
<!--    messages.scrollTop = messages.scrollHeight;-->
<!--}-->

<!--async function sendMessage() {-->
<!--    const text = input.value.trim();-->
<!--    if (!text) return;-->

<!--    addMessage("user", text);-->
<!--    input.value = "";-->

<!--    if (!verified) {-->
<!--        verifyPatient(text);-->
<!--        return;-->
<!--    }-->

<!--    try {-->
<!--        const res = await fetch("/api/v1/chat/query", {-->
<!--            method: "POST",-->
<!--            headers: { "Content-Type": "application/json" },-->
<!--            body: JSON.stringify({-->
<!--                patient_id: patientId,-->
<!--                query: text,-->
<!--                session_id: sessionId-->
<!--            })-->
<!--        });-->

<!--        const data = await res.json();-->
<!--        sessionId = data.session_id;-->
<!--        addMessage("bot", data.response);-->
<!--    } catch {-->
<!--        addMessage("bot", "Sorry, something went wrong.");-->
<!--    }-->
<!--}-->

<!--function goToVoice() {-->
<!--    window.location.href='/static/voice.html'-->
<!--}-->

<!--async function verifyPatient(mobile) {-->
<!--    statusEl.textContent = "Verifying‚Ä¶";-->

<!--    try {-->
<!--        const res = await fetch("/api/v1/verify-patient", {-->
<!--            method: "POST",-->
<!--            headers: { "Content-Type": "application/json" },-->
<!--            body: JSON.stringify({ mobile_number: mobile })-->
<!--        });-->

<!--        const data = await res.json();-->

<!--        if (data.verified) {-->
<!--            verified = true;-->
<!--            patientId = data.patient_id;-->
<!--            patientName = data.patient_name;-->
<!--            statusEl.textContent = "";-->
<!--            addMessage("bot", `Thanks ${patientName}! You can now ask questions or upload medical documents.`);-->
<!--        } else {-->
<!--            addMessage("bot", data.message || "Verification failed. Try again.");-->
<!--            statusEl.textContent = "";-->
<!--        }-->
<!--    } catch {-->
<!--        addMessage("bot", "Error verifying mobile number.");-->
<!--        statusEl.textContent = "";-->
<!--    }-->
<!--}-->

<!--fileInput.addEventListener("change", async () => {-->
<!--    const file = fileInput.files[0];-->
<!--    if (!file || !verified) return;-->

<!--    addMessage("user", `üìÑ Uploaded: ${file.name}`);-->
<!--    statusEl.textContent = "Uploading document‚Ä¶";-->

<!--    const formData = new FormData();-->
<!--    formData.append("file", file);-->
<!--    formData.append("patient_id", patientId);-->

<!--    try {-->
<!--        const res = await fetch("/api/v1/chat/upload-document", {-->
<!--            method: "POST",-->
<!--            body: formData-->
<!--        });-->

<!--        const data = await res.json();-->
<!--        statusEl.textContent = "";-->

<!--        if (data.success) {-->
<!--            addMessage("bot", data.explanation);-->
<!--        } else {-->
<!--            addMessage("bot", data.message || "Upload failed.");-->
<!--        }-->
<!--    } catch {-->
<!--        addMessage("bot", "Error uploading document.");-->
<!--        statusEl.textContent = "";-->
<!--    } finally {-->
<!--        fileInput.value = "";-->
<!--    }-->
<!--});-->

<!--input.addEventListener("keypress", e => {-->
<!--    if (e.key === "Enter") sendMessage();-->
<!--});-->
<!--</script>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medilligence ‚Ä¢ AI Patient Education</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: "Segoe UI", system-ui, sans-serif;
    background: #f4f7fb;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Container */
.container {
    width: 90%;
    max-width: 820px;
    height: 92vh;
    background: white;
    border-radius: 18px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Header */
.header {
    background: #2563eb;
    color: white;
    padding: 18px 24px;
    text-align: left;
}
.header h1 { font-size: 20px; font-weight: 600; }
.header p { font-size: 13px; opacity: 0.9; margin-top: 4px; }

/* Verify section (unchanged behavior) */
.verify-section { padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
.input-group { width: 100%; max-width: 400px; }
.input-group label { margin-bottom: 6px; display: block; font-weight: 500; }
.input-group input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
}
.btn-primary {
    margin-top: 12px;
    padding: 12px 30px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

/* Chat section */
.chat-section {
    display: none;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

.chat-info {
    padding: 10px 15px;
    background: #f1f5f9;
    font-size: 13px;
}

.messages {
    flex: 1;
    padding: 20px;
    background: #f9fafb;
    overflow-y: auto;
}

.message { display: flex; margin-bottom: 14px; }
.message.user { justify-content: flex-end; }
.message.bot { justify-content: flex-start; }

.message-content {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 16px;
    font-size: 14px;
    line-height: 1.5;
}

.message.user .message-content {
    background: #2563eb;
    color: white;
    border-bottom-right-radius: 4px;
}

.message.bot .message-content {
    background: #eef2f7;
    color: #1f2937;
    border-bottom-left-radius: 4px;
}

/* Input bar */
.input-area {
    display: flex;
    gap: 10px;
    padding: 14px 16px;
    border-top: 1px solid #e5e7eb;
    background: white;
}

.input-area input {
    flex: 1;
    padding: 12px 16px;
    border-radius: 22px;
    border: 1px solid #d1d5db;
}

.icon-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e0e7ff;
    border: none;
    cursor: pointer;
    font-size: 18px;
    color: #2563eb;

    display: flex;
    align-items: center;
    justify-content: center;
}

.send-btn {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: #2563eb;
    border: none;
    color: white;
    cursor: pointer;

    display: flex;
    align-items: center;
    justify-content: center;

}

/* Upload area ‚Äì logic preserved, UI hidden */
.upload-area { display: none; }
#fileInput { display: none; }

/* Status messages */
.loading, .error, .success {
    font-size: 13px;
    padding: 6px 15px;
}
</style>
</head>

<body>

<!--<div class="container">-->

<!--    <div class="header">-->
<!--        <h1>Medilligence</h1>-->
<!--        <p>AI Patient Education</p>-->
<!--    </div>-->

<!--    &lt;!&ndash; Verification Section (UNCHANGED) &ndash;&gt;-->
<!--    <div class="verify-section" id="verifySection">-->
<!--        <div class="input-group">-->
<!--            <label for="mobileNumber">Enter your mobile number</label>-->
<!--            <input type="tel" id="mobileNumber" placeholder="+91 1234567890">-->
<!--        </div>-->
<!--        <button class="btn-primary" onclick="verifyPatient()">Verify & Continue</button>-->
<!--        <div id="verifyMessage"></div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Chat Section &ndash;&gt;-->
<!--    <div class="chat-section" id="chatSection">-->
<!--        <div class="chat-info" id="patientInfo"></div>-->
<!--        <div class="messages" id="messages"></div>-->

<!--        &lt;!&ndash; Hidden upload logic &ndash;&gt;-->
<!--        <div class="upload-area">-->
<!--            <button id="uploadBtn"></button>-->
<!--            <input type="file" id="fileInput" accept=".pdf">-->
<!--            <div id="uploadStatus"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Input &ndash;&gt;-->
<!--        <div class="input-area">-->
<!--            <button class="icon-btn" onclick="window.location.href='/static/voice.html'">üé§</button>-->

<!--            <input type="text" id="queryInput"-->
<!--                   placeholder="Ask a health question..."-->
<!--                   onkeypress="if(event.key==='Enter') sendQuery()">-->

<!--            <button class="icon-btn" onclick="document.getElementById('fileInput').click()">üìé</button>-->

<!--            <button class="send-btn" onclick="sendQuery()">üöÄ</button>-->
<!--        </div>-->
<!--    </div>-->

<!--</div>-->

<div class="container">

    <!-- Header -->
    <div class="header">
        <h1>Medilligence</h1>
        <p>AI Patient Education</p>
    </div>

    <!-- Chat Section (SINGLE SCREEN) -->
    <div class="chat-section" id="chatSection" style="display:flex; flex-direction:column;">

        <!-- Patient Info (filled by existing JS after verification) -->
        <div class="chat-info" id="patientInfo"></div>

        <!-- Messages -->
        <div class="messages" id="messages">
            <div class="message bot">
                <div class="message-content">
                    To keep your health information secure, please enter your registered mobile number to continue.
                </div>
            </div>
        </div>

        <!-- Hidden upload logic (JS DEPENDS ON THESE IDS) -->
        <div class="upload-area" style="display:none;">
            <button id="uploadBtn"></button>
            <input type="file" id="fileInput" accept=".pdf">
            <div id="uploadStatus"></div>
        </div>

        <!-- Input -->
        <div class="input-area">

            <!-- Switch to Voice -->
            <button class="icon-btn"
                    onclick="window.location.href='/static/voice.html'">
                üé§
            </button>

            <!-- IMPORTANT: keep queryInput ID -->
            <input type="text"
                   id="queryInput"
                   placeholder="Enter mobile number or ask a health question‚Ä¶"
                   onkeypress="if(event.key==='Enter') sendQuery()">

            <!-- Upload -->
            <button class="icon-btn"
                    onclick="document.getElementById('fileInput').click()">
               <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-paperclip" viewBox="0 0 16 16">
  <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0z"/>
</svg>
            </button>

            <!-- Send -->
            <button class="send-btn" onclick="sendQuery()">‚û§</button>

        </div>

    </div>

</div>


<!-- üîí JS BELOW IS 100% COPIED FROM YOUR ORIGINAL FILE -->
<script>
    let patientId = null;
        let patientName = null;
        let sessionId = null;

        function switchMode(mode) {
            // Stay on current page
        }

        // Setup file input listener after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', uploadDocument);
            }
        });

        async function verifyPatient() {
            const mobile = document.getElementById('mobileNumber').value;
            const msgDiv = document.getElementById('verifyMessage');

            if (!mobile) {
                msgDiv.innerHTML = '<p class="error">Please enter mobile number</p>';
                return;
            }

            msgDiv.innerHTML = '<p class="loading">Verifying...</p>';

            try {
                const response = await fetch('/api/v1/verify-patient', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mobile_number: mobile })
                });

                const data = await response.json();

                if (data.verified) {
                    patientId = data.patient_id;
                    patientName = data.patient_name;
                    document.getElementById('verifySection').style.display = 'none';
                    document.getElementById('chatSection').style.display = 'flex';
                    document.getElementById('patientInfo').innerHTML =
                        `<strong>Welcome, ${patientName}!</strong> Ask questions or upload your medical documents.`;
                    addMessage('bot', 'Hello! I can help explain your medical documents and answer health questions. How can I assist you today?');
                } else {
                    msgDiv.innerHTML = `<p class="error">${data.message}</p>`;
                }
            } catch (error) {
                msgDiv.innerHTML = '<p class="error">Error verifying patient. Please try again.</p>';
                console.error('Verification error:', error);
            }
        }

        async function sendQuery() {
            const input = document.getElementById('queryInput');
            const query = input.value.trim();

            if (!query) return;

            addMessage('user', query);
            input.value = '';

            // Show typing indicator
            const typingId = addTypingIndicator();

            try {
                const response = await fetch('/api/v1/chat/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        patient_id: patientId,
                        query: query,
                        session_id: sessionId
                    })
                });

                const data = await response.json();

                // Remove typing indicator
                removeTypingIndicator(typingId);

                sessionId = data.session_id;
                addMessage('bot', data.response);
            } catch (error) {
                removeTypingIndicator(typingId);
                addMessage('bot', 'Sorry, I encountered an error. Please try again.');
                console.error('Query error:', error);
            }
        }

        async function uploadDocument(event) {
            const file = event.target.files[0];
            const statusDiv = document.getElementById('uploadStatus');
            const uploadBtn = document.getElementById('uploadBtn');

            if (!file) return;

            // Validate file type
            if (file.type !== 'application/pdf') {
                statusDiv.innerHTML = '<p class="error">Please upload a PDF file only</p>';
                event.target.value = '';
                return;
            }

            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                statusDiv.innerHTML = '<p class="error">File size must be less than 10MB</p>';
                event.target.value = '';
                return;
            }

            uploadBtn.disabled = true;
            addMessage('user', `üìÑ Uploaded: ${file.name}`);

            // Step 1: Uploading
            updateUploadStatus(statusDiv, '‚¨ÜÔ∏è Uploading document...', 'loading');

            const formData = new FormData();
            formData.append('file', file);
            formData.append('patient_id', patientId);

            try {
                // Step 2: Extracting text
                setTimeout(() => updateUploadStatus(statusDiv, 'üìÑ Extracting text from PDF...', 'loading'), 500);

                const response = await fetch('/api/v1/chat/upload-document', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok) {
                    // Show detailed error from backend
                    const errorMsg = data.detail || `Upload failed: ${response.status}`;
                    updateUploadStatus(statusDiv, `‚ùå ${errorMsg}`, 'error');
                    console.error('Backend error:', data);
                    setTimeout(() => statusDiv.innerHTML = '', 8000);
                    uploadBtn.disabled = false;
                    event.target.value = '';
                    return;
                }

                if (data.success) {
                    // Step 3: Processing
                    updateUploadStatus(statusDiv, 'üîÑ Converting to standard format...', 'loading');
                    await sleep(800);

                    // Step 4: Generating explanation
                    updateUploadStatus(statusDiv, 'ü§ñ Generating patient-friendly explanation...', 'loading');
                    await sleep(1000);

                    // Step 5: Success
                    updateUploadStatus(statusDiv, '‚úì Document processed successfully!', 'success');
                    addMessage('bot', data.explanation);

                    setTimeout(() => statusDiv.innerHTML = '', 5000);
                } else {
                    updateUploadStatus(statusDiv, `‚ùå ${data.message}`, 'error');
                    setTimeout(() => statusDiv.innerHTML = '', 5000);
                }
            } catch (error) {
                updateUploadStatus(statusDiv, '‚ùå Error uploading document. Please try again.', 'error');
                console.error('Upload error:', error);
                setTimeout(() => statusDiv.innerHTML = '', 5000);
            } finally {
                uploadBtn.disabled = false;
                event.target.value = '';
            }
        }

        function updateUploadStatus(statusDiv, message, type) {
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'loading';
            statusDiv.innerHTML = `<p class="${className}">${message}</p>`;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function addMessage(type, text) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function addTypingIndicator() {
            const messagesDiv = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            const typingId = 'typing-' + Date.now();
            typingDiv.id = typingId;
            typingDiv.className = 'message bot';
            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return typingId;
        }

        function removeTypingIndicator(typingId) {
            const typingDiv = document.getElementById(typingId);
            if (typingDiv) {
                typingDiv.remove();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
</script>

</body>
</html>
